package JUnitTests;

import static org.junit.Assert.*;

import java.util.ArrayList;

import org.junit.Rule;
import org.junit.Test;
import org.junit.rules.ExpectedException;

import Game.Item;
import Game.Player;
import medicine.Bandage;
import medicine.EpiPen;
import medicine.PetMedicine;
import pets.Cat;
import pets.Pets;

public class EpiPenTest {

	@Rule
	public ExpectedException thrown = ExpectedException.none();
	
	/**
	 * Test if I can break a EpiPen. Since it is a consumable, should expect it to fail and throw an exception
	 * if there are still uses.
	 */
	@Test
	public void testBreakEpiPen() {
		Item testEpiPen = new EpiPen();
		Player itemOwner = new Player(new ArrayList<Pets>(), "Test Player");
		itemOwner.addItem(testEpiPen);
		thrown.expect(RuntimeException.class);
		thrown.expectMessage("Can't remove/break a consumable when still has uses.");
		testEpiPen.breakItem(itemOwner);
		
		
	}
	
	
	/**
	 * Test if we can accurately check if two different instances are EpiPens.
	 */
	@Test
	public void testEquals() {
		Item epiPen1 = new EpiPen();
		Item epiPen2 = new EpiPen();
		Item notEpiPen = new PetMedicine();
		
		assertTrue(epiPen1.equals(epiPen2));
		assertFalse(epiPen1.equals(notEpiPen));
	}
	
	/**
	 * Test the hash code generated by the EpiPen item.
	 */
	@Test
	public void testHashCode() {
		Item epiPen = new EpiPen();
		double restoreValue = epiPen.getRestoreValue();
		int hashCode = (int) restoreValue * 31 + 17;
		assertEquals(hashCode, epiPen.hashCode());
	}
	
	/**
	 * Test if we can increase the number of uses of a EpiPen instance. 
	 */
	@Test
	public void testIncreaseNumUses() {
		Item testEpiPen = new EpiPen();
		testEpiPen.increaseNumUses();
		assertEquals(2, testEpiPen.getNumUses());
		testEpiPen.increaseNumUses(2);
		assertEquals(4, testEpiPen.getNumUses());
	}

	/**
	 * Test if a single consumable medicine item added to the player's inventory will be
	 * removed after its use. Inventory should be empty afterwards.
	 */
	@Test
	public void testUseEpiPen() {
		ArrayList<Pets> pets = new ArrayList<Pets>();
		pets.add(new Cat("Test Cat"));
		Player testPlayer = new Player(pets, "Test Player");
		testPlayer.addItem(new EpiPen());
		
		Pets testPet = testPlayer.getPetArray().get(0);
		
		testPlayer.getInventory().get(0).use(testPlayer, testPet);
		
		assertEquals(0, testPlayer.getInventory().size());
	}
	
	/**
	 * Test if multiple medicine instances (that are stacked in the player's inventory) 
	 * will be removed after use.
	 */
	@Test
	public void testUseStackedEpiPen() {
		ArrayList<Pets> pets = new ArrayList<Pets>();
		pets.add(new Cat("Test Cat"));
		Player testPlayer = new Player(pets, "Test Player");
		testPlayer.addItem(new EpiPen());
		testPlayer.addItem(new EpiPen());
		
		Pets testPet = testPlayer.getPetArray().get(0);
		
		assertEquals(1, testPlayer.getInventory().size());
		assertEquals(2, testPlayer.getInventory().get(0).getNumUses());
		
		testPlayer.getInventory().get(0).use(testPlayer, testPet);
		
		assertEquals(1, testPlayer.getInventory().size());
		assertEquals(1, testPlayer.getInventory().get(0).getNumUses());
		
		testPlayer.getInventory().get(0).use(testPlayer, testPet);
		
		assertEquals(0, testPlayer.getInventory().size());
	}
	
	/**
	 * Test it correctly identifies an EpiPen to be a medical item.
	 */
	@Test
	public void testIsMedicine() {
		Item testEpiPen = new EpiPen();
		assertTrue(testEpiPen.isMedicine());
		assertFalse(testEpiPen.isFood());
		assertFalse(testEpiPen.isToy());
	}
	

}
